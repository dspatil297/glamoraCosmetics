{% comment %} Related products â€” same collection, exclude current product {% endcomment %}
{% assign related_collection = product.collections.first | default: collections.all %}
{% assign related_count = 0 %}
{% assign limit = section.settings.limit | default: 4 %}
<div class="related-products shopify-section">
  <h2 class="related-products__title">{{ section.settings.heading | default: 'You may also like' }}</h2>
  <div class="related-products__grid">
    {% for prod in related_collection.products %}
      {% if prod.id != product.id and related_count < limit %}
        {% assign related_count = related_count | plus: 1 %}
        <div class="related-products__item">
          {% assign show_badge = false %}
          {% if prod.tags contains 'new' %}{% assign show_badge = true %}{% endif %}
          {% render 'product-card', product: prod, show_badge: show_badge %}
        </div>
      {% endif %}
    {% endfor %}
  </div>
</div>
{% stylesheet %}
  .related-products { padding: var(--section-padding-block) var(--page-margin); border-top: 1px solid var(--color-border); }
  .related-products__title { font-family: var(--font-heading); font-size: 1.25rem; margin: 0 0 1.5rem; }
  .related-products__grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1.5rem; }
  @media (max-width: 768px) { .related-products__grid { grid-template-columns: repeat(2, 1fr); } }
  @media (max-width: 480px) { .related-products__grid { grid-template-columns: 1fr; } }
{% endstylesheet %}
{% schema %}
{
  "name": "Related products",
  "tag": "section",
  "settings": [
    { "type": "text", "id": "heading", "label": "Heading", "default": "You may also like" },
    { "type": "range", "id": "limit", "min": 2, "max": 6, "step": 1, "default": 4, "label": "Products to show" }
  ],
  "disabled_on": { "groups": ["header", "footer"] }
}
{% endschema %}
