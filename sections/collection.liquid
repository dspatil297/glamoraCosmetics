{% comment %}
  Glamora Collection â€” banner + sidebar filters + product grid
  Use with collection-banner above on collection template.
{% endcomment %}
{% paginate collection.products by 12 %}
<div class="collection-page shopify-section">
  <div class="collection-page__layout">
    <aside class="collection-page__sidebar">
      <h2 class="collection-page__sidebar-title">Category</h2>
      <nav class="collection-page__nav">
        <a href="{{ routes.all_products_collection_url }}" class="collection-page__nav-link {% if collection.handle == 'all' %}is-active{% endif %}">All Products</a>
        {% if section.settings.filter_menu != blank and linklists[section.settings.filter_menu].links.size > 0 %}
          {% for col in linklists[section.settings.filter_menu].links %}
            <a href="{{ col.url }}" class="collection-page__nav-link {% if collection.handle == col.object.handle %}is-active{% endif %}">{{ col.title }}</a>
          {% endfor %}
        {% endif %}
      </nav>
      <h2 class="collection-page__sidebar-title">Sort by</h2>
      <form class="collection-page__filters" id="collection-filters">
        <div class="collection-page__filter">
          <select name="sort_by" id="sort-by" class="collection-page__select">
            {% for option in collection.sort_options %}
              <option value="{{ option.value }}" {% if collection.sort_by == option.value %}selected{% endif %}>{{ option.name }}</option>
            {% endfor %}
          </select>
        </div>
      </form>
      <p class="collection-page__count">Showing {{ collection.products_count }} of {{ collection.all_products_count }} products</p>
    </aside>
    <div class="collection-page__main">
      <div class="collection-page__grid">
        {% for product in collection.products %}
          <div class="collection-page__item">
            {% assign show_badge = false %}
            {% if product.tags contains 'new' or product.metafields.custom.badge == 'new' %}{% assign show_badge = true %}{% endif %}
            {% render 'product-card', product: product, show_badge: show_badge %}
          </div>
        {% endfor %}
      </div>
      {% if paginate.pages > 1 %}
        <div class="collection-page__pagination">
          {{ paginate | default_pagination }}
        </div>
      {% endif %}
    </div>
  </div>
</div>
{% endpaginate %}

<script>
  document.getElementById('sort-by') && document.getElementById('sort-by').addEventListener('change', function() {
    var url = new URL(window.location.href);
    url.searchParams.set('sort_by', this.value);
    window.location.href = url.toString();
  });
</script>

{% stylesheet %}
  .collection-page { padding: var(--section-padding-block) var(--page-margin); }
  .collection-page__layout { display: grid; grid-template-columns: 220px 1fr; gap: 2rem; max-width: var(--page-width); margin: 0 auto; }
  .collection-page__sidebar-title { font-family: var(--font-heading); font-size: 1rem; margin: 0 0 1rem; }
  .collection-page__filter { margin-bottom: 1rem; }
  .collection-page__filter label { display: block; font-size: 0.8125rem; margin-bottom: 0.25rem; }
  .collection-page__select { width: 100%; padding: 0.5rem; border: 1px solid var(--color-border); border-radius: var(--style-border-radius-inputs); background: var(--color-background); }
  .collection-page__count { font-size: 0.8125rem; color: var(--color-text-muted); margin-top: 1rem; }
  .collection-page__grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1.5rem; }
  .collection-page__pagination { margin-top: 2rem; }
  @media (max-width: 768px) {
    .collection-page__layout { grid-template-columns: 1fr; }
    .collection-page__sidebar { order: 2; }
    .collection-page__grid { grid-template-columns: repeat(2, 1fr); }
  }
  @media (max-width: 480px) { .collection-page__grid { grid-template-columns: 1fr; } }
  .collection-page__nav { display: flex; flex-direction: column; gap: 0.25rem; margin-bottom: 1rem; }
  .collection-page__nav-link { font-size: 0.875rem; color: var(--color-foreground); text-decoration: none; }
  .collection-page__nav-link:hover, .collection-page__nav-link.is-active { color: var(--color-primary); }
{% endstylesheet %}

{% schema %}
{
  "name": "Collection",
  "settings": [
    {
      "type": "link_list",
      "id": "filter_menu",
      "label": "Category menu",
      "info": "Create a menu with links to collections (e.g. Face Wash, Sunscreen). Leave blank for All Products only."
    }
  ]
}
{% endschema %}
