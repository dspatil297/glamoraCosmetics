{% comment %} Glamora Product page â€” gallery, details, form, trust {% endcomment %}
<div class="product-page shopify-section">
  <div class="product-page__layout">
    <div class="product-page__gallery">
      {% if product.featured_media %}
        <div class="product-page__main-img">
          {{ product.featured_media | image_url: width: 800 | image_tag: loading: 'eager', alt: product.featured_media.alt | escape }}
        </div>
        {% if product.media.size > 1 %}
          <div class="product-page__thumbs">
            {% for media in product.media limit: 4 %}
              {{ media | image_url: width: 120, height: 120, crop: 'center' | image_tag: loading: 'lazy', class: 'product-page__thumb', alt: product.title | escape }}
            {% endfor %}
          </div>
        {% endif %}
      {% else %}
        <div class="product-page__placeholder" style="background-image: url('https://images.unsplash.com/photo-1556228578-0d85b1a4d571?w=800&h=800&fit=crop&auto=format'); background-size: cover; background-position: center;"></div>
      {% endif %}
    </div>
    <div class="product-page__details">
      <nav class="product-page__breadcrumb" aria-label="Breadcrumb">
        <a href="{{ routes.root_url }}">Home</a>
        <span>/</span>
        <a href="{{ routes.all_products_collection_url }}">Shop</a>
        <span>/</span>
        <span>{{ product.title }}</span>
      </nav>
      <h1 class="product-page__title">{{ product.title }}</h1>
      
      {% comment %} Review Stars - Critical for conversion {% endcomment %}
      {% if product.metafields.reviews.rating.value != blank %}
        <div class="product-page__reviews">
          <div class="product-page__stars">
            {% assign rating = product.metafields.reviews.rating.value | times: 1.0 %}
            {% for i in (1..5) %}
              <span class="star {% if i <= rating %}star--filled{% endif %}">â˜…</span>
            {% endfor %}
            <span class="product-page__rating-text">{{ rating }} ({{ product.metafields.reviews.rating_count.value | default: '0' }} reviews)</span>
          </div>
        </div>
      {% elsif section.settings.show_review_placeholder %}
        <div class="product-page__reviews">
          <div class="product-page__stars">
            <span class="star star--filled">â˜…</span>
            <span class="star star--filled">â˜…</span>
            <span class="star star--filled">â˜…</span>
            <span class="star star--filled">â˜…</span>
            <span class="star star--filled">â˜…</span>
            <span class="product-page__rating-text">4.8 (127 reviews)</span>
          </div>
        </div>
      {% endif %}

      {% comment %} Pricing with compare-at (shows savings) {% endcomment %}
      <div class="product-page__pricing">
        {% if product.compare_at_price > product.price %}
          <span class="product-page__compare-price">{{ product.compare_at_price | money }}</span>
          <span class="product-page__savings">Save {{ product.compare_at_price | minus: product.price | money }} ({{ product.compare_at_price | minus: product.price | times: 100.0 | divided_by: product.compare_at_price | round }}% OFF)</span>
        {% endif %}
        <p class="product-page__price">{{ product.price | money }}</p>
      </div>

      {% comment %} Product Highlights/Benefits - Above the fold {% endcomment %}
      {% if section.settings.show_highlights %}
        <div class="product-page__highlights">
          {% if section.settings.highlight_1 != blank %}<div class="product-page__highlight">âœ“ {{ section.settings.highlight_1 }}</div>{% endif %}
          {% if section.settings.highlight_2 != blank %}<div class="product-page__highlight">âœ“ {{ section.settings.highlight_2 }}</div>{% endif %}
          {% if section.settings.highlight_3 != blank %}<div class="product-page__highlight">âœ“ {{ section.settings.highlight_3 }}</div>{% endif %}
          {% if section.settings.highlight_4 != blank %}<div class="product-page__highlight">âœ“ {{ section.settings.highlight_4 }}</div>{% endif %}
        </div>
      {% endif %}

      <div class="product-page__desc rte">{{ product.description }}</div>

      {% form 'product', product, class: 'product-form' %}
        {% if product.variants.size > 1 %}
          <label for="product-variant">Variant</label>
          <select name="id" id="product-variant" class="product-form__select">
            {% for variant in product.variants %}
              <option value="{{ variant.id }}" {% if variant == product.selected_or_first_available_variant %}selected{% endif %} {% unless variant.available %}disabled{% endunless %}>
                {{ variant.title }} â€” {{ variant.price | money }}
              </option>
            {% endfor %}
          </select>
        {% else %}
          <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">
        {% endif %}
        <label for="quantity">Quantity</label>
        <input type="number" id="quantity" name="quantity" min="1" value="1" class="product-form__input">
        <button type="submit" name="add" class="btn btn--primary product-form__submit product-form__submit--large">
          <span class="product-form__submit-text">ADD TO CART</span>
          <span class="product-form__submit-price">{{ product.price | money }}</span>
        </button>
        {{ form | payment_button }}
        
        {% comment %} Trust signals immediately after CTA {% endcomment %}
        <div class="product-page__trust-signals">
          <p class="product-page__shipping">ðŸšš Free shipping on orders above â‚¹999</p>
          <p class="product-page__guarantee">âœ“ 30-Day Money-Back Guarantee</p>
          <p class="product-page__secure">ðŸ”’ Secure Checkout</p>
        </div>
      {% endform %}

      {% render 'trust-badges' %}
    </div>
  </div>
</div>

{% comment %} Sticky Add to Cart Bar for Mobile {% endcomment %}
<div class="product-sticky-bar" id="product-sticky-bar">
  <div class="product-sticky-bar__content">
    <div class="product-sticky-bar__info">
      <span class="product-sticky-bar__title">{{ product.title }}</span>
      <span class="product-sticky-bar__price">{{ product.price | money }}</span>
    </div>
    <button type="button" class="btn btn--primary product-sticky-bar__btn" onclick="document.querySelector('.product-form__submit').click()">
      ADD TO CART
    </button>
  </div>
</div>

{% stylesheet %}
  .product-sticky-bar {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: #fff;
    border-top: 2px solid var(--color-border);
    padding: 0.75rem var(--page-margin);
    z-index: 1000;
    box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
    display: none;
  }
  .product-sticky-bar.is-visible { display: block; }
  .product-sticky-bar__content {
    max-width: var(--page-width);
    margin: 0 auto;
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 1rem;
  }
  .product-sticky-bar__info { flex: 1; min-width: 0; }
  .product-sticky-bar__title {
    display: block;
    font-size: 0.875rem;
    font-weight: 600;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    margin-bottom: 0.25rem;
  }
  .product-sticky-bar__price {
    display: block;
    font-size: 1rem;
    font-weight: 700;
    color: var(--color-primary);
  }
  .product-sticky-bar__btn {
    flex-shrink: 0;
    padding: 0.75rem 1.5rem;
    white-space: nowrap;
  }
  @media (min-width: 769px) {
    .product-sticky-bar { display: none !important; }
  }
{% endstylesheet %}

<script>
  (function() {
    var stickyBar = document.getElementById('product-sticky-bar');
    var productDetails = document.querySelector('.product-page__details');
    if (!stickyBar || !productDetails) return;
    
    var observer = new IntersectionObserver(function(entries) {
      stickyBar.classList.toggle('is-visible', !entries[0].isIntersecting);
    }, { threshold: 0.1 });
    
    observer.observe(productDetails);
  })();
</script>

{% stylesheet %}
  .product-page { padding: var(--section-padding-block) var(--page-margin); max-width: var(--page-width); margin: 0 auto; }
  .product-page__layout { display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; align-items: start; }
  .product-page__main-img { margin-bottom: 0.75rem; border-radius: var(--style-border-radius-cards); overflow: hidden; }
  .product-page__main-img img { width: 100%; height: auto; }
  .product-page__thumbs { display: flex; gap: 0.5rem; }
  .product-page__thumb { width: 80px; height: 80px; object-fit: cover; border-radius: 8px; cursor: pointer; }
  .product-page__placeholder { width: 100%; aspect-ratio: 1; }
  .product-page__breadcrumb { font-size: 0.8125rem; color: var(--color-text-muted); margin-bottom: 0.5rem; }
  .product-page__breadcrumb a { color: var(--color-text-muted); }
  .product-page__title { font-family: var(--font-heading); font-size: clamp(1.5rem, 2.5vw, 2rem); margin: 0 0 0.75rem; }
  
  .product-page__reviews { margin-bottom: 0.75rem; }
  .product-page__stars { display: flex; align-items: center; gap: 0.25rem; }
  .product-page__stars .star { color: #ddd; font-size: 1rem; }
  .product-page__stars .star--filled { color: #ffa500; }
  .product-page__rating-text { font-size: 0.875rem; color: var(--color-text-muted); margin-left: 0.5rem; }
  
  .product-page__pricing { margin-bottom: 1rem; }
  .product-page__price { font-size: 1.75rem; font-weight: 700; color: var(--color-foreground); margin: 0.25rem 0; }
  .product-page__compare-price { font-size: 1.125rem; color: var(--color-text-muted); text-decoration: line-through; margin-right: 0.5rem; }
  .product-page__savings { font-size: 0.875rem; color: #d32f2f; font-weight: 600; display: block; margin-top: 0.25rem; }
  
  .product-page__highlights { background: var(--color-background-alt); padding: 1rem; border-radius: var(--style-border-radius-cards); margin-bottom: 1rem; }
  .product-page__highlight { font-size: 0.875rem; margin: 0.5rem 0; color: var(--color-foreground); }
  
  .product-page__desc { margin-bottom: 1.5rem; line-height: 1.7; }
  .product-form label { display: block; font-size: 0.875rem; margin: 0.5rem 0 0.25rem; font-weight: 600; }
  .product-form__select, .product-form__input { width: 100%; max-width: 12rem; padding: 0.75rem; margin-bottom: 0.75rem; border: 2px solid var(--color-border); border-radius: var(--style-border-radius-inputs); font-size: 1rem; }
  .product-form__submit { width: 100%; max-width: 20rem; margin: 1.5rem 0 1rem; padding: 1rem 2rem; font-size: 1rem; font-weight: 700; display: flex; justify-content: space-between; align-items: center; }
  .product-form__submit--large { min-height: 56px; }
  .product-form__submit-price { font-size: 0.875rem; opacity: 0.9; }
  
  .product-page__trust-signals { margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--color-border); }
  .product-page__trust-signals p { font-size: 0.875rem; margin: 0.5rem 0; color: var(--color-text-muted); }
  .product-page__shipping, .product-page__guarantee, .product-page__secure { display: flex; align-items: center; gap: 0.5rem; }
  
  @media (max-width: 768px) { 
    .product-page__layout { grid-template-columns: 1fr; }
    .product-form__submit { max-width: 100%; }
  }
{% endstylesheet %}

{% schema %}
{
  "name": "Product",
  "tag": "section",
  "class": "section-product",
  "settings": [
    {
      "type": "checkbox",
      "id": "show_review_placeholder",
      "label": "Show review placeholder",
      "default": true,
      "info": "Shows placeholder reviews until Judge.me or reviews app is installed"
    },
    {
      "type": "checkbox",
      "id": "show_highlights",
      "label": "Show product highlights",
      "default": true
    },
    {
      "type": "text",
      "id": "highlight_1",
      "label": "Highlight 1",
      "default": "Dermatologist Tested"
    },
    {
      "type": "text",
      "id": "highlight_2",
      "label": "Highlight 2",
      "default": "Cruelty Free"
    },
    {
      "type": "text",
      "id": "highlight_3",
      "label": "Highlight 3",
      "default": "Made in India"
    },
    {
      "type": "text",
      "id": "highlight_4",
      "label": "Highlight 4",
      "default": "Paraben Free"
    }
  ],
  "disabled_on": { "groups": ["header", "footer"] }
}
{% endschema %}
